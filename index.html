<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Santa Biblia 1909 — IA</title>
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#b8860b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="robots" content="noindex, nofollow">

<!-- 
  ╔══════════════════════════════════════════════════════════╗
  ║  Santa Biblia 1909 — Con Agente IA                       ║
  ║  © Todos los derechos reservados                         ║
  ║  El contenido de esta aplicación está cifrado.           ║
  ║  No se permite la reproducción sin autorización.         ║
  ╚══════════════════════════════════════════════════════════╝
-->

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --gold: #b8860b;
    --gold-bright: #ffd700;
    --dark: #0f0600;
    --parchment: #f5e6c8;
  }

  body {
    background: var(--dark);
    color: var(--parchment);
    font-family: 'Georgia', serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  #loader {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    transition: opacity 0.6s ease;
  }

  .cross {
    font-size: 64px;
    color: var(--gold-bright);
    text-shadow: 0 0 30px rgba(255,215,0,0.6);
    animation: glow 2s ease-in-out infinite alternate;
  }

  @keyframes glow {
    from { text-shadow: 0 0 20px rgba(255,215,0,0.4); }
    to   { text-shadow: 0 0 50px rgba(255,215,0,0.9), 0 0 80px rgba(255,215,0,0.3); }
  }

  .title {
    font-size: 22px;
    color: var(--gold-bright);
    letter-spacing: 3px;
    text-align: center;
    text-shadow: 0 0 20px rgba(255,215,0,0.4);
  }

  .subtitle {
    font-size: 11px;
    color: rgba(245,230,200,0.5);
    letter-spacing: 5px;
    text-transform: uppercase;
  }

  .progress-wrap {
    width: 280px;
    height: 3px;
    background: rgba(184,134,11,0.2);
    border-radius: 2px;
    overflow: hidden;
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--gold), var(--gold-bright));
    border-radius: 2px;
    transition: width 0.3s ease;
    box-shadow: 0 0 10px rgba(255,215,0,0.5);
  }

  .status {
    font-size: 12px;
    color: rgba(245,230,200,0.5);
    letter-spacing: 2px;
    min-height: 18px;
  }

  #app {
    display: none;
    width: 100%;
    height: 100vh;
    border: none;
    position: fixed;
    top: 0; left: 0;
  }
</style>
</head>
<body>

<div id="loader">
  <div class="cross">✝</div>
  <div class="title">Santa Biblia 1909</div>
  <div class="subtitle">Con Agente IA</div>
  <div class="progress-wrap">
    <div class="progress-bar" id="bar"></div>
  </div>
  <div class="status" id="status">Iniciando…</div>
</div>

<!-- El contenido se renderiza aquí en un iframe aislado -->
<iframe id="app" sandbox="allow-scripts allow-same-origin allow-forms" title="Santa Biblia 1909"></iframe>

<script>
(function() {
  'use strict';

  // ── Clave de descifrado (fragmentada para dificultar extracción) ──
  const _k = ['Bibl','ia19','09RV','A-Pr','otec','tedC','onte','nt-K','ey-2','024-','GitH','ubPa','ges'];
  const KEY = _k.join('');
  const KEY_BYTES = new TextEncoder().encode(KEY);

  const bar   = document.getElementById('bar');
  const status = document.getElementById('status');

  function setProgress(pct, msg) {
    bar.style.width = pct + '%';
    if (msg) status.textContent = msg;
  }

  // ── Descifrado XOR en Workers (no bloquea UI) ──
  function xorDecrypt(encryptedBytes, keyBytes) {
    const out = new Uint8Array(encryptedBytes.length);
    const kl = keyBytes.length;
    for (let i = 0; i < encryptedBytes.length; i++) {
      out[i] = encryptedBytes[i] ^ keyBytes[i % kl];
    }
    return out;
  }

  // ── Base64 → Uint8Array ──
  function b64ToBytes(b64) {
    const bin = atob(b64);
    const bytes = new Uint8Array(bin.length);
    for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
    return bytes;
  }

  // ── Renderizar en iframe (aislado del inspector) ──
  function renderInFrame(html) {
    const frame = document.getElementById('app');
    const loader = document.getElementById('loader');

    // Loader fade out
    loader.style.opacity = '0';
    setTimeout(() => {
      loader.style.display = 'none';
      frame.style.display = 'block';
    }, 600);

    // Escribir en iframe — srcdoc no es inspeccionable como fuente normal
    frame.srcdoc = html;

    // Borrar la variable de memoria tras un tick
    setTimeout(() => { html = null; }, 100);
  }

  // ── Flujo principal ──
  async function init() {
    // 1. Registrar Service Worker
    if ('serviceWorker' in navigator) {
      try {
        await navigator.serviceWorker.register('./sw.js', { scope: './' });
        setProgress(10, 'Caché activado…');
      } catch(e) {
        setProgress(10, 'Cargando…');
      }
    }

    // 2. Obtener archivo cifrado (desde cache si disponible)
    setProgress(20, 'Leyendo Escrituras…');
    let encText;
    try {
      const resp = await fetch('./bible.enc', { cache: 'force-cache' });
      if (!resp.ok) throw new Error('fetch failed');
      encText = await resp.text();
    } catch(e) {
      // Segundo intento sin force-cache
      const resp = await fetch('./bible.enc');
      encText = await resp.text();
    }
    setProgress(60, 'Procesando…');

    // 3. Descifrar en memoria
    const encBytes = b64ToBytes(encText.trim());
    encText = null; // liberar memoria inmediatamente
    setProgress(80, 'Descifrado en progreso…');

    // Pequeno delay para que el browser respire
    await new Promise(r => setTimeout(r, 50));

    const decBytes = xorDecrypt(encBytes, KEY_BYTES);
    setProgress(95, 'Abriendo…');

    const html = new TextDecoder('utf-8').decode(decBytes);

    // 4. Render
    setProgress(100, '');
    await new Promise(r => setTimeout(r, 200));
    renderInFrame(html);
  }

  // ── Bloquear clic derecho e inspección ──
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if (
      e.key === 'F12' ||
      (e.ctrlKey && e.shiftKey && ['I','J','C','U'].includes(e.key)) ||
      (e.ctrlKey && e.key === 'U') ||
      (e.metaKey && e.altKey && e.key === 'I')
    ) { e.preventDefault(); e.stopPropagation(); }
  });

  init().catch(err => {
    status.textContent = 'Error: ' + err.message;
    console.warn('Init error:', err);
  });

})();
</script>
</body>
</html>
