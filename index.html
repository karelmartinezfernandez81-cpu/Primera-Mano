<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Santa Biblia 1909 — IA</title>
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#b8860b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="robots" content="noindex, nofollow">

<!-- 
  ╔══════════════════════════════════════════════════════════╗
  ║  Santa Biblia 1909 — Con Agente IA                       ║
  ║  © Todos los derechos reservados                         ║
  ║  El contenido de esta aplicación está cifrado.           ║
  ║  No se permite la reproducción sin autorización.         ║
  ╚══════════════════════════════════════════════════════════╝
-->

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --gold: #b8860b;
    --gold-bright: #ffd700;
    --dark: #0f0600;
    --parchment: #f5e6c8;
  }

  body {
    background: var(--dark);
    color: var(--parchment);
    font-family: 'Georgia', serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  #loader {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    transition: opacity 0.6s ease;
  }

  .cross {
    font-size: 64px;
    color: var(--gold-bright);
    text-shadow: 0 0 30px rgba(255,215,0,0.6);
    animation: glow 2s ease-in-out infinite alternate;
  }

  @keyframes glow {
    from { text-shadow: 0 0 20px rgba(255,215,0,0.4); }
    to   { text-shadow: 0 0 50px rgba(255,215,0,0.9), 0 0 80px rgba(255,215,0,0.3); }
  }

  .title {
    font-size: 22px;
    color: var(--gold-bright);
    letter-spacing: 3px;
    text-align: center;
    text-shadow: 0 0 20px rgba(255,215,0,0.4);
  }

  .subtitle {
    font-size: 11px;
    color: rgba(245,230,200,0.5);
    letter-spacing: 5px;
    text-transform: uppercase;
  }

  .progress-wrap {
    width: 280px;
    height: 3px;
    background: rgba(184,134,11,0.2);
    border-radius: 2px;
    overflow: hidden;
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--gold), var(--gold-bright));
    border-radius: 2px;
    transition: width 0.3s ease;
    box-shadow: 0 0 10px rgba(255,215,0,0.5);
  }

  .status {
    font-size: 12px;
    color: rgba(245,230,200,0.5);
    letter-spacing: 2px;
    min-height: 18px;
  }

</style>
</head>
<body>

<div id="loader">
  <div class="cross">✝</div>
  <div class="title">Santa Biblia 1909</div>
  <div class="subtitle">Con Agente IA</div>
  <div class="progress-wrap">
    <div class="progress-bar" id="bar"></div>
  </div>
  <div class="status" id="status">Iniciando…</div>
</div>

<script>
(function() {
  'use strict';

  // ── Clave de descifrado (fragmentada para dificultar extracción) ──
  const _k = ['Bibl','ia19','09RV','A-Pr','otec','tedC','onte','nt-K','ey-2','024-','GitH','ubPa','ges'];
  const KEY = _k.join('');
  const KEY_BYTES = new TextEncoder().encode(KEY);

  const bar    = document.getElementById('bar');
  const status = document.getElementById('status');

  function setProgress(pct, msg) {
    bar.style.width = pct + '%';
    if (msg) status.textContent = msg;
  }

  // ── Descifrado XOR en memoria ──
  function xorDecrypt(encryptedBytes, keyBytes) {
    const out = new Uint8Array(encryptedBytes.length);
    const kl = keyBytes.length;
    for (let i = 0; i < encryptedBytes.length; i++) {
      out[i] = encryptedBytes[i] ^ keyBytes[i % kl];
    }
    return out;
  }

  // ── Base64 → Uint8Array ──
  function b64ToBytes(b64) {
    const bin = atob(b64);
    const bytes = new Uint8Array(bin.length);
    for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
    return bytes;
  }

  // ── Renderizar: reemplaza la página completa en memoria ──
  // document.write sustituye el DOM actual — localStorage, indexedDB,
  // todos los scripts y botones funcionan al 100%.
  // view-source seguirá mostrando este loader, NO el HTML descifrado.
  function renderPage(html) {
    // Pequeño fade antes de reemplazar
    document.getElementById('loader').style.opacity = '0';
    setTimeout(() => {
      document.open('text/html', 'replace');
      document.write(html);
      document.close();
      html = null; // liberar memoria
    }, 350);
  }

  // ── Flujo principal ──
  async function init() {

    // 1. Registrar Service Worker (caché offline)
    if ('serviceWorker' in navigator) {
      try {
        await navigator.serviceWorker.register('./sw.js', { scope: './' });
        setProgress(10, 'Caché activado…');
      } catch(e) {
        setProgress(10, 'Iniciando…');
      }
    }

    // 2. Cargar archivo cifrado (desde caché del SW si ya se visitó antes)
    setProgress(20, 'Leyendo Escrituras…');
    let encText;
    try {
      const resp = await fetch('./bible.enc', { cache: 'force-cache' });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      encText = await resp.text();
    } catch(e) {
      // Segundo intento sin force-cache
      const resp = await fetch('./bible.enc');
      if (!resp.ok) throw new Error(`No se pudo cargar bible.enc (${resp.status})`);
      encText = await resp.text();
    }
    setProgress(55, 'Escrituras recibidas…');

    // 3. Descifrar en memoria
    const encBytes = b64ToBytes(encText.trim());
    encText = null; // liberar inmediatamente

    setProgress(75, 'Procesando…');
    await new Promise(r => setTimeout(r, 30)); // respiro para el browser

    const decBytes = xorDecrypt(encBytes, KEY_BYTES);
    setProgress(92, 'Preparando…');

    const html = new TextDecoder('utf-8').decode(decBytes);
    setProgress(100, '');

    // 4. Render completo
    await new Promise(r => setTimeout(r, 250));
    renderPage(html);
  }

  // ── Bloquear inspector y clic derecho en el loader ──
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if (
      e.key === 'F12' ||
      (e.ctrlKey && e.shiftKey && ['I','J','C','U'].includes(e.key)) ||
      (e.ctrlKey && e.key === 'U') ||
      (e.metaKey && e.altKey && e.key === 'I')
    ) { e.preventDefault(); e.stopPropagation(); }
  }, true);

  init().catch(err => {
    status.textContent = '⚠ ' + err.message;
    console.warn('Error al cargar:', err);
  });

})();
</script>
</body>
</html>
