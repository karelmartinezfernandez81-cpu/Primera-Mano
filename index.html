<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Santa Biblia 1909 — IA</title>
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#b8860b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="robots" content="noindex, nofollow">
<!--
  ╔══════════════════════════════════════════════════════════╗
  ║  Santa Biblia 1909 — Con Agente IA                       ║
  ║  © Todos los derechos reservados                         ║
  ║  El contenido de esta aplicación está cifrado.           ║
  ╚══════════════════════════════════════════════════════════╝
-->
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  :root{--gold:#b8860b;--gold-bright:#ffd700;--dark:#0f0600;--parchment:#f5e6c8}
  body{background:var(--dark);color:var(--parchment);font-family:Georgia,serif;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}
  #loader{display:flex;flex-direction:column;align-items:center;gap:24px;transition:opacity .5s ease}
  .cross{font-size:64px;color:var(--gold-bright);text-shadow:0 0 30px rgba(255,215,0,.6);animation:glow 2s ease-in-out infinite alternate}
  @keyframes glow{from{text-shadow:0 0 20px rgba(255,215,0,.4)}to{text-shadow:0 0 50px rgba(255,215,0,.9),0 0 80px rgba(255,215,0,.3)}}
  .ttl{font-size:22px;color:var(--gold-bright);letter-spacing:3px;text-align:center;text-shadow:0 0 20px rgba(255,215,0,.4)}
  .sub{font-size:11px;color:rgba(245,230,200,.5);letter-spacing:5px;text-transform:uppercase}
  .pw{width:280px;height:3px;background:rgba(184,134,11,.2);border-radius:2px;overflow:hidden}
  #bar{height:100%;width:0%;background:linear-gradient(90deg,var(--gold),var(--gold-bright));transition:width .3s ease;box-shadow:0 0 10px rgba(255,215,0,.5)}
  #st{font-size:12px;color:rgba(245,230,200,.5);letter-spacing:2px;min-height:18px;text-align:center}
</style>
</head>
<body>
<div id="loader">
  <div class="cross">✝</div>
  <div class="ttl">Santa Biblia 1909</div>
  <div class="sub">Con Agente IA</div>
  <div class="pw"><div id="bar"></div></div>
  <div id="st">Iniciando…</div>
</div>

<script>
(function(){
'use strict';

// ── Clave fragmentada (no aparece como texto completo) ──
var _k=['Bibl','ia19','09RV','A-Pr','otec','tedC','onte','nt-K','ey-2','024-','GitH','ubPa','ges'];
var KEY=_k.join('');
var KEY_B=new TextEncoder().encode(KEY);

var bar=document.getElementById('bar');
var st=document.getElementById('st');

function prog(p,m){bar.style.width=p+'%';if(m!==undefined)st.textContent=m;}

function b64ToBytes(b64){
  var bin=atob(b64),b=new Uint8Array(bin.length);
  for(var i=0;i<bin.length;i++)b[i]=bin.charCodeAt(i);
  return b;
}

function xorDec(enc,key){
  var out=new Uint8Array(enc.length),kl=key.length;
  for(var i=0;i<enc.length;i++)out[i]=enc[i]^key[i%kl];
  return out;
}

// ────────────────────────────────────────────────────
// launch(): reemplaza la página completa con el HTML
// descifrado. document.open/write/close es la técnica
// más compatible — sustituye TODO el DOM incluyendo
// <html>, <head>, <body>. localStorage, IndexedDB,
// media queries y todos los scripts funcionan igual
// que si el HTML se hubiera cargado directamente.
// Ctrl+U / view-source solo muestra este loader.
// ────────────────────────────────────────────────────
function launch(html){
  document.getElementById('loader').style.opacity='0';
  setTimeout(function(){
    document.open();
    document.write(html);
    document.close();
    html=null;
  },300);
}

async function init(){

  // 1. Registrar Service Worker (gestiona caché offline)
  //    updateViaCache:'none' → el SW siempre se re-verifica desde red
  if('serviceWorker' in navigator){
    try{
      var reg=await navigator.serviceWorker.register('./sw.js',{
        scope:'./',
        updateViaCache:'none'
      });
      // Si hay un SW nuevo esperando, activarlo ya
      if(reg.waiting){
        reg.waiting.postMessage({type:'SKIP_WAITING'});
      }
      reg.addEventListener('updatefound',function(){
        var nw=reg.installing;
        if(!nw)return;
        nw.addEventListener('statechange',function(){
          if(nw.state==='installed'&&navigator.serviceWorker.controller){
            nw.postMessage({type:'SKIP_WAITING'});
          }
        });
      });
      prog(10,'Caché activado…');
    }catch(e){
      prog(10,'Cargando…');
    }
  }

  // 2. Obtener archivo cifrado
  //    Primera visita → descarga desde red y lo guarda el SW
  //    Siguientes visitas → 0 datos, sale del caché del SW
  prog(20,'Leyendo Escrituras…');
  var encText;
  try{
    var r=await fetch('./bible.enc',{cache:'default'});
    if(!r.ok)throw new Error('HTTP '+r.status);
    encText=await r.text();
  }catch(e){
    var r2=await fetch('./bible.enc',{cache:'reload'});
    if(!r2.ok)throw new Error('No se pudo cargar bible.enc');
    encText=await r2.text();
  }
  prog(55,'Escrituras recibidas…');

  // 3. Descifrar en memoria (XOR + Base64)
  var encBytes=b64ToBytes(encText.trim());
  encText=null; // liberar memoria
  prog(75,'Procesando…');
  await new Promise(function(r){setTimeout(r,20);});

  var decBytes=xorDec(encBytes,KEY_B);
  var html=new TextDecoder('utf-8').decode(decBytes);
  decBytes=null;
  prog(100,'');

  // 4. Reemplazar página
  await new Promise(function(r){setTimeout(r,200);});
  launch(html);
}

// Bloquear F12 / inspector en la pantalla del loader
document.addEventListener('contextmenu',function(e){e.preventDefault();});
document.addEventListener('keydown',function(e){
  if(e.key==='F12'
    ||(e.ctrlKey&&e.shiftKey&&'IJCU'.includes(e.key))
    ||(e.ctrlKey&&e.key==='U')
    ||(e.metaKey&&e.altKey&&e.key==='I')){
    e.preventDefault();e.stopPropagation();
  }
},true);

init().catch(function(err){
  st.textContent='⚠ '+err.message;
  console.warn('Error al cargar:',err);
});
})();
</script>
</body>
</html>
