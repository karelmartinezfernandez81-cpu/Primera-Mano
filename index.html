<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Santa Biblia ‚Äî IA</title>
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#b8860b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="robots" content="noindex, nofollow">
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #b8860b;
  --gold-light: #d4a017;
  --gold-bright: #ffd700;
  --dark: #0a0400;
  --dark2: #130800;
  --dark3: #1c0d05;
  --parchment: #f5e6c8;
  --parchment-dim: rgba(245,230,200,0.55);
  --crimson: #6b0f0f;
  --red-err: #e05555;
  --green-ok: #4caf50;
  --border: rgba(184,134,11,0.35);
}
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--dark);
  color: var(--parchment);
  font-family: 'Crimson Text', Georgia, serif;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

/* ‚îÄ‚îÄ Fondo animado ‚îÄ‚îÄ */
.bg {
  position: fixed; inset: 0; z-index: 0; overflow: hidden;
  background: radial-gradient(ellipse at 50% 0%, #2a1200 0%, #0a0400 60%);
}
.bg-ray {
  position: absolute; top: -20%; left: 50%; width: 1px;
  transform-origin: top center;
  background: linear-gradient(to bottom, rgba(212,160,23,0.18), transparent);
  animation: ray 8s ease-in-out infinite;
}
.bg-ray:nth-child(1){ height:70vh; transform:rotate(-30deg); animation-delay:0s; }
.bg-ray:nth-child(2){ height:55vh; transform:rotate(-10deg); animation-delay:1.5s; opacity:.7; }
.bg-ray:nth-child(3){ height:65vh; transform:rotate(15deg);  animation-delay:3s; }
.bg-ray:nth-child(4){ height:45vh; transform:rotate(35deg);  animation-delay:4.5s; opacity:.5; }
@keyframes ray { 0%,100%{opacity:.3} 50%{opacity:.8} }

.particles {
  position: absolute; inset: 0;
}
.p { position: absolute; border-radius: 50%; background: var(--gold-bright); animation: float linear infinite; opacity: 0; }

@keyframes float {
  0%   { transform: translateY(100vh) scale(1); opacity: 0; }
  10%  { opacity: .6; }
  90%  { opacity: .3; }
  100% { transform: translateY(-10vh) scale(0.3); opacity: 0; }
}

/* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
.card {
  position: relative; z-index: 10;
  width: min(420px, 94vw);
  background: linear-gradient(160deg, #1a0a02, #120700, #1e0e04);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 40px 36px 36px;
  box-shadow: 0 0 60px rgba(184,134,11,.15), 0 0 120px rgba(0,0,0,.8);
  animation: cardIn .6s ease both;
}
@keyframes cardIn {
  from { opacity:0; transform: translateY(24px) scale(.97); }
  to   { opacity:1; transform: translateY(0)    scale(1); }
}

/* Borde dorado superior */
.card::before {
  content: '';
  position: absolute; top: 0; left: 10%; right: 10%;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--gold-bright), transparent);
  border-radius: 2px;
}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
.hdr { text-align: center; margin-bottom: 32px; }

.cross-wrap {
  width: 64px; height: 64px;
  margin: 0 auto 16px;
  display: flex; align-items: center; justify-content: center;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(184,134,11,.25) 0%, transparent 70%);
  animation: pulse 3s ease-in-out infinite;
}
@keyframes pulse { 0%,100%{box-shadow:0 0 0 0 rgba(255,215,0,.3)} 50%{box-shadow:0 0 0 18px rgba(255,215,0,0)} }

.cross-icon { font-size: 40px; filter: drop-shadow(0 0 12px rgba(255,215,0,.8)); }

.hdr-title {
  font-family: 'Cinzel Decorative', serif;
  font-size: 17px;
  color: var(--gold-bright);
  letter-spacing: 1px;
  text-shadow: 0 0 20px rgba(255,215,0,.4);
}
.hdr-sub {
  font-family: 'Cinzel', serif;
  font-size: 9px;
  letter-spacing: 4px;
  color: var(--parchment-dim);
  margin-top: 6px;
  text-transform: uppercase;
}

/* ‚îÄ‚îÄ Separador ‚îÄ‚îÄ */
.divider {
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 28px; color: rgba(184,134,11,.4); font-size: 12px;
}
.divider::before, .divider::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(184,134,11,.4), transparent);
}

/* ‚îÄ‚îÄ Campos ‚îÄ‚îÄ */
.field { margin-bottom: 18px; }
.field label {
  display: block;
  font-family: 'Cinzel', serif;
  font-size: 9.5px;
  letter-spacing: 2px;
  color: var(--gold-light);
  text-transform: uppercase;
  margin-bottom: 8px;
}
.field-wrap { position: relative; }
.field input {
  width: 100%;
  background: rgba(245,230,200,.05);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 11px 42px 11px 14px;
  color: var(--parchment);
  font-family: 'Crimson Text', serif;
  font-size: 15px;
  outline: none;
  transition: all .25s;
  -webkit-appearance: none;
}
.field input::placeholder { color: rgba(245,230,200,.25); font-style: italic; }
.field input:focus {
  border-color: rgba(212,160,23,.7);
  background: rgba(245,230,200,.08);
  box-shadow: 0 0 0 3px rgba(184,134,11,.12);
}
.field input.ok   { border-color: var(--green-ok) !important; }
.field input.fail { border-color: var(--red-err) !important; }

/* Icono estado */
.field-icon {
  position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  font-size: 16px; pointer-events: none;
  transition: opacity .2s;
}
.hint {
  font-size: 11px; color: rgba(245,230,200,.3);
  margin-top: 5px; padding-left: 2px;
  font-style: italic;
  display: flex; align-items: center; gap: 5px;
}
.hint a { color: var(--gold); text-decoration: none; }
.hint a:hover { text-decoration: underline; }

/* ‚îÄ‚îÄ Mensaje de estado ‚îÄ‚îÄ */
#msg {
  min-height: 20px;
  text-align: center;
  font-size: 12.5px;
  letter-spacing: .5px;
  margin-bottom: 16px;
  transition: all .3s;
  padding: 0 4px;
}
#msg.err  { color: var(--red-err); }
#msg.ok   { color: var(--green-ok); }
#msg.info { color: var(--parchment-dim); }

/* ‚îÄ‚îÄ Bot√≥n ‚îÄ‚îÄ */
.btn-enter {
  width: 100%;
  padding: 13px;
  background: linear-gradient(135deg, #8a6200, var(--gold), #8a6200);
  background-size: 200% 100%;
  border: none;
  border-radius: 8px;
  color: #1a0800;
  font-family: 'Cinzel', serif;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 3px;
  cursor: pointer;
  transition: all .3s;
  position: relative;
  overflow: hidden;
}
.btn-enter:hover { background-position: 100% 0; box-shadow: 0 4px 20px rgba(212,160,23,.45); }
.btn-enter:active { transform: scale(.98); }
.btn-enter:disabled { opacity: .5; cursor: not-allowed; transform: none; }

.btn-enter .btn-spinner {
  display: none;
  width: 16px; height: 16px;
  border: 2px solid rgba(26,8,0,.3);
  border-top-color: #1a0800;
  border-radius: 50%;
  animation: spin .7s linear infinite;
  margin: 0 auto;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ Loading overlay (despu√©s de auth) ‚îÄ‚îÄ */
#loading {
  display: none;
  position: fixed; inset: 0; z-index: 100;
  background: var(--dark);
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 24px;
}
#loading.show { display: flex; }
.ld-cross { font-size: 60px; animation: glow 2s ease-in-out infinite alternate; }
@keyframes glow {
  from { text-shadow: 0 0 20px rgba(255,215,0,.4); }
  to   { text-shadow: 0 0 50px rgba(255,215,0,.9), 0 0 80px rgba(255,215,0,.3); }
}
.ld-title {
  font-family: 'Cinzel Decorative', serif;
  font-size: 18px; color: var(--gold-bright);
  letter-spacing: 2px; text-align: center;
}
.ld-pw { width: 260px; height: 2px; background: rgba(184,134,11,.2); border-radius: 2px; overflow: hidden; }
#ld-bar { height: 100%; width: 0%; background: linear-gradient(90deg,var(--gold),var(--gold-bright)); transition: width .3s; box-shadow: 0 0 10px rgba(255,215,0,.5); }
#ld-st { font-size: 11px; letter-spacing: 2px; color: var(--parchment-dim); }

/* Eye toggle */
.eye-btn {
  position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  background: none; border: none; color: var(--parchment-dim);
  cursor: pointer; font-size: 16px; padding: 2px; line-height: 1;
  transition: color .2s;
}
.eye-btn:hover { color: var(--gold); }
</style>
</head>
<body>

<!-- Fondo animado -->
<div class="bg">
  <div class="bg-ray"></div><div class="bg-ray"></div>
  <div class="bg-ray"></div><div class="bg-ray"></div>
  <div class="particles" id="particles"></div>
</div>

<!-- Card de login -->
<div class="card" id="card">

  <div class="hdr">
    <div class="cross-wrap"><span class="cross-icon">‚úù</span></div>
    <div class="hdr-title">Santa Biblia</div>
    <div class="hdr-sub">Con Agente de Inteligencia Artificial</div>
  </div>

  <div class="divider">ACCESO</div>

  <!-- Usuario -->
  <div class="field">
    <label>Nombre de usuario</label>
    <div class="field-wrap">
      <input type="text" id="f-user" placeholder="Tu nombre‚Ä¶" autocomplete="username" maxlength="40">
      <span class="field-icon" id="ico-user"></span>
    </div>
  </div>

  
  <div class="field">
    <label>Clave IA de Texto</label>
    <div class="field-wrap">
      <input type="password" id="f-or" placeholder="Clave IA de Texto‚Ä¶" autocomplete="off" maxlength="120">
      <button class="eye-btn" type="button" onclick="toggleEye('f-or',this)" tabindex="-1">üëÅ</button>
    </div>
    
  </div>

  
  <div class="field">
    <label>Clave IA de Im√°genes</label>
    <div class="field-wrap">
      <input type="password" id="f-horde" placeholder="Clave IA de Im√°genes‚Ä¶" autocomplete="off" maxlength="80">
      <button class="eye-btn" type="button" onclick="toggleEye('f-horde',this)" tabindex="-1">üëÅ</button>
    </div>
    
  </div>

  <div id="msg" class="info"></div>

  <button class="btn-enter" id="btn-enter" onclick="doLogin()">
    <span id="btn-txt">ENTRAR</span>
    <div class="btn-spinner" id="btn-spin"></div>
  </button>

</div>

<!-- Loading overlay despu√©s de auth -->
<div id="loading">
  <div class="ld-cross">‚úù</div>
  <div class="ld-title">Abriendo las Escrituras‚Ä¶</div>
  <div class="ld-pw"><div id="ld-bar"></div></div>
  <div id="ld-st">Iniciando‚Ä¶</div>
</div>

<script>
// ‚îÄ‚îÄ Part√≠culas de fondo ‚îÄ‚îÄ
(function(){
  var container = document.getElementById('particles');
  for(var i=0;i<18;i++){
    var p=document.createElement('div');
    p.className='p';
    var size = Math.random()*3+1;
    p.style.cssText=[
      'width:'+size+'px','height:'+size+'px',
      'left:'+Math.random()*100+'%',
      'animation-duration:'+(Math.random()*20+15)+'s',
      'animation-delay:'+(Math.random()*15)+'s',
      'opacity:0'
    ].join(';');
    container.appendChild(p);
  }
})();

// ‚îÄ‚îÄ Eye toggle ‚îÄ‚îÄ
function toggleEye(id, btn){
  var inp = document.getElementById(id);
  inp.type = inp.type==='password' ? 'text' : 'password';
  btn.textContent = inp.type==='password' ? 'üëÅ' : 'üôà';
}

// ‚îÄ‚îÄ Estado del formulario ‚îÄ‚îÄ
function setMsg(txt,cls){ var m=document.getElementById('msg'); m.textContent=txt; m.className=cls||'info'; }
function setField(id,state){
  var inp=document.getElementById(id);
  inp.classList.remove('ok','fail');
  if(state) inp.classList.add(state);
}
function setBusy(b){
  var btn=document.getElementById('btn-enter');
  var txt=document.getElementById('btn-txt');
  var spin=document.getElementById('btn-spin');
  btn.disabled=b;
  txt.style.display=b?'none':'block';
  spin.style.display=b?'block':'none';
}


async function checkOR(key){
  try{
    var r=await fetch('https://openrouter.ai/api/v1/models',{
      headers:{'Authorization':'Bearer '+key}
    });
    return r.ok; // 200 = key v√°lida
  }catch(e){ return false; }
}


async function checkHorde(key){
  try{
    var r=await fetch('https://aihorde.net/api/v2/find_user',{
      headers:{
        'apikey': key,
        'Client-Agent': 'BibliaSagradaIA:1.0:biblia'
      }
    });
    return r.ok;
  }catch(e){ return false; }
}

// ‚îÄ‚îÄ Login ‚îÄ‚îÄ
async function doLogin(){
  var user  = document.getElementById('f-user').value.trim();
  var orKey = document.getElementById('f-or').value.trim();
  var hKey  = document.getElementById('f-horde').value.trim();

  // Validaci√≥n b√°sica
  if(!user){
    setMsg('Por favor introduce tu nombre de usuario','err');
    document.getElementById('f-user').focus();
    return;
  }
  if(!orKey || !orKey.startsWith('sk-or')){
    setField('f-or','fail');
    setMsg('La Clave IA de Texto no es v√°lida','err');
    document.getElementById('f-or').focus();
    return;
  }
  if(!hKey || hKey.length < 4){
    setField('f-horde','fail');
    setMsg('Introduce la Clave IA de Im√°genes','err');
    document.getElementById('f-horde').focus();
    return;
  }

  // Reset estados
  setField('f-or',''); setField('f-horde','');
  setBusy(true);

  
  setMsg('Verificando Clave IA de Texto‚Ä¶','info');
  var orOk = await checkOR(orKey);
  if(!orOk){
    setField('f-or','fail');
    setMsg('‚ùå Clave IA de Texto inv√°lida o sin conexi√≥n','err');
    setBusy(false);
    return;
  }
  setField('f-or','ok');

  
  setMsg('Verificando Clave IA de Im√°genes‚Ä¶','info');
  var hOk = await checkHorde(hKey);
  if(!hOk){
    setField('f-horde','fail');
    setMsg('‚ùå Clave IA de Im√°genes inv√°lida o sin conexi√≥n','err');
    setBusy(false);
    return;
  }
  setField('f-horde','ok');

  setMsg('‚úÖ Acceso concedido ‚Äî bienvenido, '+user+'','ok');

  // ‚îÄ‚îÄ Guardar en localStorage ‚îÄ‚îÄ
  localStorage.setItem('biblia_username',    user);
  localStorage.setItem('or_key_biblia',      orKey);
  localStorage.setItem('horde_key_biblia',   hKey);

  // Esperar un momento para que el usuario vea el OK
  await new Promise(r=>setTimeout(r,700));

  // ‚îÄ‚îÄ Mostrar overlay de carga y descifrar ‚îÄ‚îÄ
  document.getElementById('card').style.opacity='0';
  document.getElementById('card').style.transform='scale(.96)';
  document.getElementById('card').style.transition='all .4s ease';
  await new Promise(r=>setTimeout(r,350));
  document.getElementById('loading').classList.add('show');
  loadBible();
}

// ‚îÄ‚îÄ Descifrado y lanzamiento de la Biblia ‚îÄ‚îÄ
var _k=['Bibl','ia19','09RV','A-Pr','otec','tedC','onte','nt-K','ey-2','024-','GitH','ubPa','ges'];
var KEY = _k.join('');
var KEY_B = new TextEncoder().encode(KEY);

function b64ToBytes(b64){
  var bin=atob(b64),b=new Uint8Array(bin.length);
  for(var i=0;i<bin.length;i++)b[i]=bin.charCodeAt(i);
  return b;
}
function xorDec(enc,key){
  var out=new Uint8Array(enc.length),kl=key.length;
  for(var i=0;i<enc.length;i++)out[i]=enc[i]^key[i%kl];
  return out;
}
function ldProg(p,m){
  document.getElementById('ld-bar').style.width=p+'%';
  if(m!==undefined) document.getElementById('ld-st').textContent=m;
}

async function loadBible(){
  // Registrar SW
  if('serviceWorker' in navigator){
    try{
      var reg=await navigator.serviceWorker.register('./sw.js',{scope:'./',updateViaCache:'none'});
      if(reg.waiting) reg.waiting.postMessage({type:'SKIP_WAITING'});
      reg.addEventListener('updatefound',function(){
        var nw=reg.installing; if(!nw)return;
        nw.addEventListener('statechange',function(){
          if(nw.state==='installed'&&navigator.serviceWorker.controller)
            nw.postMessage({type:'SKIP_WAITING'});
        });
      });
    }catch(e){}
  }

  ldProg(15,'Cargando Escrituras‚Ä¶');
  var encText;
  try{
    var r=await fetch('./bible.enc',{cache:'default'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    encText=await r.text();
  }catch(e){
    var r2=await fetch('./bible.enc',{cache:'reload'});
    if(!r2.ok){ document.getElementById('ld-st').textContent='‚ö† Error cargando bible.enc'; return; }
    encText=await r2.text();
  }
  ldProg(55,'Escrituras recibidas‚Ä¶');

  var encBytes=b64ToBytes(encText.trim()); encText=null;
  ldProg(75,'Procesando‚Ä¶');
  await new Promise(r=>setTimeout(r,20));

  var decBytes=xorDec(encBytes,KEY_B);
  var html=new TextDecoder('utf-8').decode(decBytes); decBytes=null;
  ldProg(100,'Abriendo‚Ä¶');
  await new Promise(r=>setTimeout(r,250));

  document.open();
  document.write(html);
  document.close();
  html=null;
}

// Bloquear inspector
document.addEventListener('contextmenu',function(e){e.preventDefault();});
document.addEventListener('keydown',function(e){
  if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&'IJCU'.includes(e.key))||(e.ctrlKey&&e.key==='U')||(e.metaKey&&e.altKey&&e.key==='I')){
    e.preventDefault();e.stopPropagation();
  }
},true);

// Enter para enviar
document.addEventListener('keydown',function(e){
  if(e.key==='Enter'&&!document.getElementById('btn-enter').disabled) doLogin();
});


</script>
</body>
</html>
